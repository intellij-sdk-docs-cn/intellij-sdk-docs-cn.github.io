


<!doctype html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <title>Indexing and PSI Stubs / IntelliJ Platform SDK  DevGuide</title>
    <link rel="stylesheet" href="/intellij/sdk/docs/app/app.css">
    <link rel="shortcut icon" href="/intellij/sdk/docs/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" sizes="57x57" href="/intellij/sdk/docs/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/intellij/sdk/docs/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/intellij/sdk/docs/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/intellij/sdk/docs/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/intellij/sdk/docs/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/intellij/sdk/docs/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/intellij/sdk/docs/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/intellij/sdk/docs/apple-touch-icon-180x180.png">
    <link rel="mask-icon" href="/intellij/sdk/docs/apple-mask-icon.svg" color="black">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-square70x70logo" content="/intellij/sdk/docs/mstile-70x70.png">
    <meta name="msapplication-TileImage" content="/intellij/sdk/docs/mstile-144x144.png">
    <meta name="msapplication-square150x150logo" content="/intellij/sdk/docs/mstile-150x150.png">
    <meta name="msapplication-wide310x150logo" content="/intellij/sdk/docs/mstile-310x150.png">
    <meta name="msapplication-square310x310logo" content="/intellij/sdk/docs/mstile-310x310.png">
    <meta name="theme-color" content="#000000">
    <meta name="description" content="Documentation for working with and extending the IntelliJ Platform SDK" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://intellij-sdk-docs-cn.github.io/intellij/sdk/docs//basics/indexing_and_psi_stubs.html" />
    <meta property="og:site_name" content="JetBrains IntelliJ Platform SDK" />
    <meta property="og:title" content="Indexing and PSI Stubs" />
    <meta property="og:description" content="Documentation for working with and extending the IntelliJ Platform SDK" />
    <meta property="og:image" content="https://intellij-sdk-docs-cn.github.io/intellij/sdk/docs/jetbrains.png" />
    <meta property="article:modified_time" content="2020-02-19T22:25:03+08:00" />
    <!-- <meta property="article:section" content="" /> 
    <meta property="article:tag" content="" /> -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@JBPlatform" />
    <meta name="twitter:title" content="Indexing and PSI Stubs" />
    <meta name="twitter:description" content="Documentation for working with and extending the IntelliJ Platform SDK" />
    <meta name="twitter:image" content="https://intellij-sdk-docs-cn.github.io/intellij/sdk/docs/jetbrains.png" />
    <meta class="swiftype" name="product" data-type="string" content="/intellij/sdk/docs/"></meta>
<link  rel="stylesheet" href="/intellij/sdk/docs/app/styles.css"></head>
<body data-id="basics/indexing_and_psi_stubs">
<div class="wrapper">
    <section class="panel _nav">
        <header class="panel__header">
            <div class="container">
                <form class="search-box">
                    <label for="search-box__input" class="search-box__label">
                        <input type="text" class="search-box__input" id="search-box__input" placeholder="Search IntelliJ Platform SDK  DevGuide">
                    </label>
                    <div class="search-box__clear" title="Clear"></div>
                </form>
            </div>
        </header>
        <nav class="panel__content">
            <div class="container _nav">
                <menu class="nav-tree"></menu>
            </div>
            <div class="container _footer panel__footer">
                <p><a data-bypass="true" href="//youtrack.jetbrains.com/issues/IJSDK">Send feedback</a></p>
                <p>&copy; 2000&ndash;2020 <a href="//www.jetbrains.com">JetBrains</a> s.r.o.<br>
                    All rights reserved.</p>
            </div>
        </nav>
    </section>

    <main class="panel _main" role="main">
        <header class="panel__header">
            <div class="container">
                <h3>IntelliJ Platform SDK DevGuide</h3>
                
                <div class="panel-trigger"></div>
            </div>
        </header>
        <section class="panel__content">
            <div class="container">
                <article class="article" data-shortcut-switcher="false">
                    <div class="navigation-links _top" data-swiftype-index="false">
                        <a class="navigation-links__prev" href="/basics/psi_cookbook.html">PSI Cookbook</a>
                        <a class="navigation-links__next" href="/reference_guide/frameworks_and_external_apis/xml_dom_api.html">XML DOM API</a>
                    </div>
                    <a data-bypass="true" href="https://github.com/intellij-sdk-docs-cn/intellij-sdk-docs-cn/edit/master/basics/indexing_and_psi_stubs.md" class="page-link-to-github" target="_blank" title="Edit this page on GitHub">
                        <i class="github-icon"></i>
                        <span class="text">Edit page</span>
                    </a>

                    <h1>Indexing and PSI Stubs</h1>
                    <!-- Copyright 2000-2020 JetBrains s.r.o. and other contributors. Use of this source code is governed by the Apache 2.0 license that can be found in the LICENSE file. -->

<a name="indices" class="elem-anchor"></a>
<h2>Indices<a href="#indices" class="anchor-link"><span></span></a></h2>

<p>The indexing framework provides a quick way to locate certain elements, e.g. files containing a certain word or methods with a particular name, in large code bases. Plugin developers can use the existing indexes built by the IDE itself, as well as build and use their own indexes.</p>

<p>It supports two main types of indexes:</p>

<ul>
  <li><a href="/intellij/sdk/docs/basics/indexing_and_psi_stubs/file_based_indexes.html"><span>File-based indices</span></a></li>
  <li><a href="/intellij/sdk/docs/basics/indexing_and_psi_stubs/stub_indexes.html"><span>Stub indices</span></a></li>
</ul>

<p>File-based indexes are built directly over the content of files. Stub indexes are built over serialized <em>stub trees</em>. A stub tree for a source file is a subset of its PSI tree which contains only externally visible declarations and is serialized in a compact binary format.</p>

<p>Querying a file-based index gets you the set of files matching a certain condition. Querying a stub index gets you the set of matching PSI elements. Therefore, custom language plugin developers should typically use stub indexes in their plugin implementations.</p>

<aside>
  <aside class="tip">
    <p> <a href="https://plugins.jetbrains.com/plugin/13029-indices-viewer/" data-bypass="yes" target="_blank"><span>Indices Viewer</span></a> is a plugin that helps inspecting indices’ contents and properties. 
Please see also <a href="/intellij/sdk/docs/reference_guide/performance/performance.html#improving-indexing-performance"><span>Improving indexing performance</span></a>.</p>
  </aside>
</aside>

<a name="dumb-mode" class="elem-anchor"></a>
<h2>Dumb mode<a href="#dumb-mode" class="anchor-link"><span></span></a></h2>

<p>Indexing is a potentially long process. It’s performed in background, and during this time, IDE’s features are restricted to the ones that don’t require index: basic text editing, version control etc. This restriction is managed by <a href="https://upsource.jetbrains.com/idea-ce/file/idea-ce-e2d423f42b53eafd5c625b93149a0ebc7e49756c/platform/core-api/src/com/intellij/openapi/project/DumbService.java" data-bypass="yes" target="_blank"><span><code class="code highlight language-text">DumbService</code></span></a>.</p>

<p><code class="code highlight language-text">DumbService</code> provides API to query whether the IDE is currently in “dumb” mode (where index access is not allowed) or “smart” mode (with all index built and ready to use). It also provides ways of delaying code execution until indices are ready. Please see its javadoc for more details.</p>

<a name="gists" class="elem-anchor"></a>
<h2>Gists<a href="#gists" class="anchor-link"><span></span></a></h2>

<p>Sometimes, the following conditions hold:</p>

<ul>
  <li>the aggregation functionality of file-based indices is not needed. One just needs to calculate some data based on particular file’s contents, and cache it on disk</li>
  <li>eagerly calculating the data for the entire project during indexing isn’t needed (e.g. it slows down the indexing, and/or this data probably will ever be needed for a minor subset of all project files)</li>
  <li>the data can be recalculated lazily on request without major performance penalties</li>
</ul>

<p>In such cases, file-based index can be used, but file gists provide a way to perform data calculation lazily, caching on disk, and a more lightweight API. Please see <a href="https://upsource.jetbrains.com/idea-ce/file/idea-ce-e2d423f42b53eafd5c625b93149a0ebc7e49756c/platform/indexing-api/src/com/intellij/util/gist/VirtualFileGist.java" data-bypass="yes" target="_blank"><span><code class="code highlight language-text">VirtualFileGist</code></span></a> and <a href="https://upsource.jetbrains.com/idea-ce/file/idea-ce-e2d423f42b53eafd5c625b93149a0ebc7e49756c/platform/indexing-api/src/com/intellij/util/gist/PsiFileGist.java" data-bypass="yes" target="_blank"><span><code class="code highlight language-text">PsiFileGist</code></span></a> documentation.</p>


                    <div class="navigation-links _bottom" data-swiftype-index="false">
                        <a class="navigation-links__prev" href="/basics/psi_cookbook.html">PSI Cookbook</a>
                        <a class="navigation-links__next" href="/reference_guide/frameworks_and_external_apis/xml_dom_api.html">XML DOM API</a>
                    </div>
                    <div class="last-modified">
                        Last modified: 19 February 2020
                    </div>
                </article>

                <section class="disqus">
                    <div id="disqus_thread"></div>
                </section>
            </div>
        </section>
    </main>
</div>

<script src="/intellij/sdk/docs/app/app.js" data-baseurl="/intellij/sdk/docs/"></script>

</body>
</html>

